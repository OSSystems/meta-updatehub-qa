#@TYPE: Machine
#@NAME: QEMU i386
#@DESCRIPTION: Machine configuration using QEMU i386 for GRUB EFI backend test

MACHINEOVERRIDES =. "qemux86:"
KMACHINE_pn-linux-yocto = "qemux86"
PREFERRED_PROVIDER_virtual/kernel = "linux-yocto"
PREFERRED_PROVIDER_virtual/bootloader = "u-boot-updatehub"
PREFERRED_PROVIDER_u-boot-fw-utils = "u-boot-updatehub-fw-utils"

require conf/machine/include/qemu.inc
require conf/machine/include/tune-i586.inc

KERNEL_IMAGETYPE = "bzImage"

UBOOT_MACHINE = "qemu-x86_efi_payload32_defconfig"

UBOOT_SUFFIX = "efi"
UBOOT_BINARY = "u-boot-payload.efi"

SERIAL_CONSOLES = "115200;ttyS0"

MACHINE_FEATURES += "x86"

IMAGE_FSTYPES = "tar.xz wic.gz"
IMAGE_DEPENDS_wic_append = " dosfstools-native mtools-native virtual/bootloader"

IMAGE_BOOT_FILES = "u-boot-payload.efi;efi/boot/bootia32.efi"

MACHINE_ESSENTIAL_EXTRA_RDEPENDS_append = " kernel-image"

# UpdateHub settings
UPDATEHUB_DEVICE_IDENTITY = "primary-iface"
UPDATEHUB_INSTALL_MODE = "copy tarball"
UPDATEHUB_FILESYSTEM_SUPPORT = "vfat ext4"
UPDATEHUB_DEVICE_ATTRIBUTE += "kernel cpu-model mem-total"
UPDATEHUB_IMAGE_TYPE = "active/inactive"
UPDATEHUB_ACTIVE_INACTIVE_BACKEND = "u-boot"
